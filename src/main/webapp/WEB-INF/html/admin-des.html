<#assign base=request.contextPath />
<#import "spring.ftl" as spring/>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <base id="base" href="${base}">
    <title>后台列表</title>
    <link rel="stylesheet" id="thickbox-css" href="${base}/css/admin.css" type="text/css"/>
    <link rel="stylesheet" id="olida-bootstrap-css" href="${base}/css/bootstrap.css?ver=4.7.7" type="text/css" media="all"/>
</head>
<body>
<div class="des">
    <div class="list-main">
        <a href="${base}/index">未来设计</a>
        <a class="active" href="${base}/admin-list">作品列表</a>
    </div>
</div>
<div class="des-main">
    <div class="main-list">
    <input type="hidden" value="${id}" id="id"></input>
        <p class="title">作品列表>添加作品</p>
        <div class="list-top clearfix">
            <p class="one clearfix">
                <span class="first">请选择作品类别（单选）：</span>
                <span data-id="1" >城市形象</span> <!--class="active"-->
                <span data-id="2">品牌策划</span>
                <span data-id="3">品牌平面视觉</span>
                <span data-id="4">品牌互联网视觉</span>
                <span data-id="5">品牌空间视觉</span>

                
            </p>
            <p class="two">请选择作品标签（最多三个）：</p>
            <p  data-id="1" class="three-1 tubi-none clearfix">
               <span class="first">城市形象</span>
                <span>景观</span>
                <span>公共艺术</span>
                <span>建筑</span>
                <span>民宿</span>
                <span>特色小镇研究</span>
            </p>
            <p  data-id="2" class="three-2 tubi-none display-none clearfix">
               <span class="first">品牌策划</span>
                <span>市场调查</span>
                <span>消费者研究</span>
                <span>品牌定位</span>
                <span>品牌命名</span>
            </p>
            <p  data-id="3" class="three-3 tubi-none display-none clearfix">
                <span class="first">品牌平面视觉</span>
                <span>logo设计</span>
                <span>VI设计</span>
                <span>产品包装</span>
                <span>海报</span>
                <span>书册</span>
            </p>
            <p  data-id="4" class="three-4 tubi-none display-none clearfix">
                <span class="first">品牌互联网视觉</span>
                <span>网站</span>
                <span>APP</span>
                <span>H5</span>
            </p>
            <p  data-id="5" class="three-5 tubi-none display-none clearfix">
                <span class="first">品牌空间视觉</span>
                <span>主题空间</span>
                <span>导视</span>
                <span>空间装置</span> 
            </p>
           <!-- <p  data-id="6" class="three-6 tubi-none display-none clearfix">
                <span class="first">制作和施工</span>
                <span>平面设计打样及制作</span>
                <span>画册、包装印刷制作</span> 
                <span>网站.APP.H5开发</span>
                <span>店面装修总包</span>
            </p>-->
        </div>
        <div class="list-middle">
            <p class="furo clearfix">
                <span class="color">作品标题</span>
                <span class="input-1">
                    <input type="text" name="zh_title" id="zh_title" value="${product.zh_title}">
                    <span>中文</span>
                </span>
                <span class="input-2">
                    <input type="text" name="en_title" id="en_title" value="${product.en_title}">
                    <span>英文</span>
                </span>
            </p>
            <p class="furo clearfix">
                <span  class="color">作品描述</span>
                <span class="input-1">
                    <textarea rows="8" name="zh_descript" id="zh_descript">${product.zh_descript}</textarea>
                    <span>中文</span>
                </span>
                <span class="input-2">
                    <textarea rows="8" name="en_descript" id="en_descript">${product.en_descript}</textarea>
                    <span>英文</span>
                </span>
            </p>
            <div class="photo clearfix">
                <div class="photo-left">
                    <p class="tubi-p">
                        <span class="color">作品封面</span>
                        <span>（支持jpg、png格式，封面显示尺寸为4：3比例）</span>
                    </p>
                    <a href="javascript:;" class="a-upload-1">
                        <input type="file" name="file" id="file1" style="width:400px;height:400px" onchange="imgUpload()"> 
                        <input type="hidden" id="img" value=""> 
                         <#if product.imgUrl??>
                           <img   width='400px' height='400px'  src="${product.imgUrl}" id="fileImage1"> 
                         <#else>
                           <img   width='400px' height='400px'  src="${base}/images/icon-jia.png" id="fileImage1"> 
                         </#if>
                       
                       
                    </a>
                </div>
                <div class="photo-right">
                    <p class="tubi-p">
                        <span  class="color">作品主图</span>
                        <span>（支持jpg、png格式，主图是1920*1080的大背景图）</span>
                    </p>
                    <a href="javascript:;" class="a-upload-1">
                        <input type="file" name="file" id="file2" style="width:400px;height:400px" onchange="picUpload()">
                        <input type="hidden" id="pic" value="">  
                         <#if product.picUrl??>
                           <img width='400px' height='400px' src="${product.picUrl}" id="fileImage2">
                         <#else>
                           <img width='400px' height='400px' src="${base}/images/icon-jia.png" id="fileImage2"> 
                         </#if>
                    </a>
                </div>
            </div>
            <p class="photo-sctp">
                <span class="color">上传作品图片</span>
                <span>支持jpg、png、gif、mp4格式</span>
            </p>
            <p>
                <a href="javascript:;" class="a-upload">
                    <input type="file" name="file" id="file3" onchange="imgsUpload()">点击这里上传文件
                    <input type="hidden" id="imgs" value="">
                </a>
            </p>
            <div class="bottom-image clearfix" id="uploadFiles">
            
                 <#list productImgs as productImg> 
					 <div class="image-li">
	                    <img src="${productImg.imgUrl}">
	                    <p><a onclick='deleteImg(this)'>删除</a></p>
	                </div>
					</#list>
               <!--  <div class="image-li">
                    <img src="${base}/images/2.jpg">
                    <p>删除</p>
                </div>
                <div class="image-li">
                    <img src="${base}/images/2.jpg">
                    <p>删除</p>
                </div>
                <div class="image-li">
                    <img src="${base}/images/2.jpg">
                    <p>删除</p>
                </div> -->
            </div>
        </div>
    </div>
</div>
<div class="bottom-main">
    <div class="main-bottom">
        <p class="">
            <span class="p-left">设置为首页作品</span>
            <label class="tu"> 
            <#if product.isHomePage==1>
                <input type="checkbox" name="isHomePage" id="isHomePage" checked>是
            <#else>
               <input type="checkbox" name="isHomePage" id="isHomePage">是
            </#if>
            
            </label>
          <!-- <label><input type="radio" name="radio">否</label>- -->
            <span class="p-wz">放置位置</span>
            <select name="num" id="num">
                <option value="1" <#if product.num==1>selected</#if>>1</option>
                <option value="2" <#if product.num==2>selected</#if>>2</option>
                <option value="3" <#if product.num==3>selected</#if>>3</option>
                <option value="4" <#if product.num==4>selected</#if>>4</option>
                <option value="5" <#if product.num==5>selected</#if>>5</option>
                <option value="6" <#if product.num==6>selected</#if>>6</option>
                <option value="7" <#if product.num==7>selected</#if>>7</option>
                <option value="8" <#if product.num==8>selected</#if>>8</option>
                <option value="9" <#if product.num==9>selected</#if>>9</option>
                <option value="10" <#if product.num==10>selected</#if>>10</option>
                <option value="11" <#if product.num==11>selected</#if>>11</option>
            </select>
            <span class="p-wz">第几屏展示</span>
            <select name="dimension" id="dimension">
                <option value="2" <#if product.dimension==2>selected</#if>>第一屏</option>
                <option value="3" <#if product.dimension==3>selected</#if>>第二屏</option>
            </select>
        </p>
    </div>
</div>
<div class="bottom-bottom">
    <div class="bottom-a clearfix">
        <#if product?exists>
          <a href="javascript:edit()">编辑</a>
         <#else>
           <a href="javascript:add()">添加</a>
        </#if>  
    </div>
</div>
<!--<script type="text/javascript" src="${base}/js/jquery-1.9.1.min.js"></script>-->
<script src="${base}/js/jquery-1.11.0.min.js"></script>
<!--<script type="text/javascript" src="${base}/js/index.js"></script>-->
<script type="text/javascript" src="${base}/js/jquery.ajaxfileupload.js"></script>
<script type="text/javascript">
    /**
     * Created by maker on 2016/11/5.
     */
  // var labels = [];


    var data_id =  "${product.type}";
   if(data_id!=""){
        $(".des-main .main-list .list-top p.one span[data-id = '"+data_id+"']").addClass('active');
       $(".tubi-none").addClass('display-none');
       $(".tubi-none[data-id = '"+data_id+"']").removeClass('display-none');
       $(".tubi-none span").removeClass("active")

       $.each($(".tubi-none span"),function(index,label){
          if($(this).html()=="${product.zh_label1}" ||
              $(this).html()=="${product.zh_label2}" ||
              $(this).html()=="${product.zh_label3}"){
              $(this).addClass("active")
          }
       });
    };
    
    $(function () {
 
        $(".li-in").hover(function(){
            $(this).find(".tubi").stop().toggle(500)
        })
        $(".tubi-ul li").bind("click", function () {
            var data_id = $(this).attr("data-id");
            $(".tubi-ul li").removeClass('active');
            $(".tubi-ul li[data-id = '"+data_id+"']").addClass('active');
            $(".main-list").addClass('display-none');
            $(".main-list[data-id = '"+data_id+"']").removeClass('display-none');
        });
        $(".des-main .main-list .list-top p.one span").bind("click", function () {
            var data_id = $(this).attr("data-id");
            $(".des-main .main-list .list-top p.one span").removeClass('active');
            $(".des-main .main-list .list-top p.one span[data-id = '"+data_id+"']").addClass('active');

            $(".tubi-none").addClass('display-none');
            $(".tubi-none[data-id = '"+data_id+"']").removeClass('display-none');
            $(".tubi-none span").removeClass("active")
        });
        $(".tubi-none span").bind("click", function () {
            if($(this).hasClass("active")){
                $(this).removeClass("active")
              //  labels.splice($.inArray($(this).text(),labels),1);
             //   alert(labels)
            }else{
                if($(".tubi-none").find(".active").length < 3){
                    $(this).addClass("active")
                  //  labels.push($(this).text());
                //    alert($(this).text())
                 //   alert(labels)
                }else{
                    alert("最多选择3个")
                }
            }
        });
    });

   /**
    * 删除图片
    **/
    function deleteImg(x){   
        $(x).parent().parent().remove();
    }
     
  //  init();

    //如果是编辑页存在初始化
    var id = 0;
    function init(){
         id  = '${id}';
         if(id!=''){
        	 var zh_title = "${product.zh_title}";
        	 var dimension = "${product.dimension}";
             var num =  "${product.num}"; 
             alert("id"+id);
             $("#num").find("option[text='"+num+"']").attr("selected",true); 
         }
        
    }

    
    function imgUpload() {
        $.ajaxFileUpload
        (
            {
                url: '${base}/imgUpload', //用于文件上传的服务器端请求地址
                secureuri: false, //是否需要安全协议，一般设置为false
                fileElementId: 'file1', //文件上传域的ID
                dataType: 'JSON', //返回值类型 一般设置为json
                success: function (data, status)  //服务器成功响应处理函数 
                { 
                    var data = eval("("+data+")"); 
                    $("#fileImage1").attr("src",data.img);
                //    alert("图片上传成功");
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    alert(e);
                }
            }
        )
        return false;
    }
    function picUpload() {
        $.ajaxFileUpload
        (
            {
                url: '${base}/imgUpload', //用于文件上传的服务器端请求地址
                secureuri: false, //是否需要安全协议，一般设置为false
                fileElementId: 'file2', //文件上传域的ID 
                dataType: 'JSON', //返回值类型 一般设置为json 
                success: function (data, status)  //服务器成功响应处理函数
                { 
                    console.log(data); 
                    var data = eval("("+data+")");
                    $("#fileImage2").attr("src",data.img);
                 //   alert("图片上传成功");
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    alert(e);
                }
            }
        )
        return false;
    }

    /**
    * 上传多张图片
    **/
    function imgsUpload() {
        $.ajaxFileUpload
        (
            {
                url: '${base}/imgUpload', //用于文件上传的服务器端请求地址
                secureuri: false, //是否需要安全协议，一般设置为false
                fileElementId: 'file3', //文件上传域的ID 
                dataType: 'JSON', //返回值类型 一般设置为json 
                success: function (data, status)  //服务器成功响应处理函数
                {
                	console.log(data); 
                    var data = eval("("+data+")");  
                    $("#imgs").val($("#imgs").val()+"_"+data.img);
                    $("#uploadFiles").append("<div class='image-li'><img  src='"+data.img+"'><p><a onclick='deleteImg(this)'>删除</a></p></div>"); 
                    console.log(data)
                 //   alert("图片上传成功")
                },
                error: function (data, status, e)//服务器响应失败处理函数
                {
                    alert(e);
                }
            }
        )
        return false;
    }

    function add() {
        var labels = [];
        $.each($(".tubi-none span"),function(index,label){
            if($(this).hasClass("active")){
                labels.push($(this).text())
            }
        });
        var zh_type = "";
    
        $.each( $(".des-main .main-list .list-top p.one span"),function(index,n){
            if($(this).hasClass("active")){
                zh_type=$(this).text();
            }
        }); 
        
   	  var productImgs = new Array();
      $("#uploadFiles>.image-li>img").each(function(ele){
      	productImgs.push($(this).attr("src"));
      });
          
        if(zh_type==""){
            alert("请选择作品类别")
            return false;
        }
        if(labels.length==0){
            alert("请选择作品标签")
            return false;
        }
        if($("#zh_title").val()==""){
            alert("请填写中文标题");
            return false;
        }
        if($("#en_title").val()==""){
            alert( "请填写英文标题");
            return false;
        }
        if($("#zh_descript").val()==""){
            alert( "请填写中文描述");
            return false;
        }
        if($("#en_descript").val()==""){
            alert( "请填写英文描述");
            return false;
        }
        if($("#fileImage1").attr("src")==""){
            alert("请选择主图")
            return false;
        }
        if($("#fileImage2").attr("src")==""){
            alert("请选择封面")
            return false;
        }
        if(productImgs.length==0){
            alert("请上传作品图")
            return false;
        }
        var en_type,type;

        if(zh_type=="城市形象"){
            en_type = "City Image";
            type = 1;
        }else if(zh_type=="品牌策划"){
            en_type = "Brand planning";
            type = 2;
        }else if(zh_type=="品牌平面视觉"){
            en_type = "Brand Graphic vision";
            type = 3;
        }else if(zh_type=="品牌互联网视觉"){
            en_type = "Brand internet vision";
            type = 4;
        }else if(zh_type=="品牌空间视觉"){
            en_type = "Brand space vision";
            type = 5;
        }
 

        console.info($("#imgs").val());
      
        var zh_label1 = "",en_label1 = "",zh_label2="",en_label2 = "",zh_label3="",en_label3="";
        
        $.each(labels,function(index,label){
            if(index==0){
                zh_label1 = label;
               en_label1 = zhToEnLlabel(label);
            }else if(index==1){
                zh_label2 = label;
                en_label2 = zhToEnLlabel(label);
            }else if(index=3){
                zh_label3 = label
                en_label3 = zhToEnLlabel(label);
            }
        });
        $.ajax({
            type : "POST",
            url : "${base}/add",
            dataType : "json",
            data : {
                en_title : $("#en_title").val(),     //英文标题
                zh_title : $("#zh_title").val(),     //中文标题
                type : type,           //分类，一次定义为1,2,3,4,5
                en_type : en_type,       //分类中文名称
                zh_type : zh_type,       //分类英文名称
                en_label1 : en_label1,     //英文标签1
                zh_label1 : zh_label1,      //中文标签1
                en_label2 : en_label2,
                zh_label2 : zh_label2,
                en_label3 : en_label3,
                zh_label3 : zh_label3,
                en_descript : $("#en_descript").val(),      //英文表述
                zh_descript : $("#zh_descript").val(),      //中文描述
                imgUrl : $("#fileImage1").attr("src"),           //封面图片地址
                picUrl : $("#fileImage2").attr("src"),
                dimension : $("#dimension").val(),         //2维作品或者3维作品，值为2或3
                isHomePage : $("#isHomePage")[0].checked?1:0,        //是否显示在首页1是，0否
                num : $("#num").val(),                //如果显示在首页填1-11数字，代表首页的位置，否则填0
                productImgs : productImgs
            },
            success : function(data) {
                console.log(data)
                $("#result").empty();
                //   $("#result").html(data)
                $("#result").text(JSON.stringify(data))
                alert("添加成功")
                location.href="${base}/admin-list"
            }
        });
    }

    function zhToEnLlabel(label) {
        if(label=="景观"){
            return "Landscape";
        }else if(label=="公共艺术"){
            return "Public Art";
        }else if(label=="建筑"){
            return "Building";
        }else if(label=="民宿"){
            return "hostel";
        }else if(label=="特色小镇研究"){
            return "Research on Characteristic Towns";
        }else if(label=="市场调查"){
            return "market research";
        }else if(label=="消费者研究"){
            return "Consumer research";
        }else if(label=="品牌定位"){
            return "Brand positioning";
        }else if(label=="品牌命名"){
            return "Brand naming";
        }else if(label=="logo设计"){
            return "Logo";
        }else if(label=="VI系统"){
            return "VI";
        }else if(label=="产品包装"){
            return "Product packaging";
        }else if(label=="海报"){
            return "poster";
        }else if(label=="书册"){
            return "Picture album";
        }else if(label=="网站"){
            return "Website";
        }else if(label=="APP"){
            return "APP";
        }else if(label=="H5"){
            return "h5";
        }else if(label=="主题空间"){
            return "Topic space";
        }else if(label=="导视"){
            return "Guide";
        }else if(label=="空间装置"){
            return "Space device";
        }

    }

     


    function edit() {
    	 id  = '${id}';
    //	 alert("edit"+id);
        var labels = [];
        $.each($(".tubi-none span"),function(index,label){
            if($(this).hasClass("active")){
                labels.push($(this).text())
            }
        });
        var zh_type = "";
        $.each( $(".des-main .main-list .list-top p.one span"),function(index,n){
            if($(this).hasClass("active")){
                zh_type=$(this).text();
            }
        }); 
    	 var productImgs = new Array();
         $("#uploadFiles>.image-li>img").each(function(ele){
         	productImgs.push($(this).attr("src"));
         }); 
         
        if(zh_type==""){
            alert("请选择作品类别")
            return false;
        }
        if(labels.length==0){
            alert("请选择作品标签")
            return false;
        }
        if($("#zh_title").val()==""){
            alert("请填写中文标题");
            return false;
        }
        if($("#en_title").val()==""){
            alert( "请填写英文标题");
            return false;
        }
        if($("#zh_descript").val()==""){
            alert( "请填写中文描述");
            return false;
        }
        if($("#en_descript").val()==""){
            alert( "请填写英文描述");
            return false;
        }
        if($("#fileImage1").attr("src")==""){
            alert("请选择主图")
            return false;
        }
        if($("#fileImage2").attr("src")==""){
            alert("请选择封面")
            return false;
        }
        if(productImgs.length==0){
            alert("请上传作品图")
            return false;
        }
        var en_type,type;

        if(zh_type=="城市形象"){
            en_type = "City Image";
            type = 1;
        }else if(zh_type=="品牌策划"){
            en_type = "Brand planning";
            type = 2;
        }else if(zh_type=="品牌平面视觉"){
            en_type = "Brand Graphic vision";
            type = 3;
        }else if(zh_type=="品牌互联网视觉"){
            en_type = "Brand internet vision";
            type = 4;
        }else if(zh_type=="品牌空间视觉"){
            en_type = "Brand space vision";
            type = 5;
        }
        
        console.info($("#imgs").val());
        var productImgs = new Array();
        $("#uploadFiles>.image-li>img").each(function(ele){
        	productImgs.push($(this).attr("src"));
        }); 
        var zh_label1 = "",en_label1 = "",zh_label2="",en_label2 = "",zh_label3="",en_label3="";
        
        $.each(labels,function(index,label){
            if(index==0){
                zh_label1 = label;
               en_label1 = zhToEnLlabel(label);
            }else if(index==1){
                zh_label2 = label;
                en_label2 = zhToEnLlabel(label);
            }else if(index=3){
                zh_label3 = label
                en_label3 = zhToEnLlabel(label);
            }
        });
        $.ajax({
            type : "POST",
            url : "${base}/edit",
            dataType : "json",
            data : {
                id:id,
                en_title : $("#en_title").val(),     //英文标题
                zh_title : $("#zh_title").val(),     //中文标题
                type : type,           //分类，一次定义为1,2,3,4,5
                en_type : en_type,       //分类中文名称
                zh_type : zh_type,       //分类英文名称
                en_label1 : en_label1,     //英文标签1
                zh_label1 : zh_label1,      //中文标签1
                en_label2 : en_label2,
                zh_label2 : zh_label2,
                en_label3 : en_label3,
                zh_label3 : zh_label3,
                en_descript : $("#en_descript").val(),      //英文表述
                zh_descript : $("#zh_descript").val(),      //中文描述
                imgUrl : $("#fileImage1").attr("src"),           //封面图片地址
                picUrl : $("#fileImage2").attr("src"),
                dimension : $("#dimension").val(),         //2维作品或者3维作品，值为2或3
                isHomePage : $("#isHomePage")[0].checked?1:0,        //是否显示在首页1是，0否
                num : $("#num").val(),                //如果显示在首页填1-11数字，代表首页的位置，否则填0
                productImgs : productImgs
            },
            success : function(data) {
                console.log(data)

                $("#result").empty();
                //   $("#result").html(data)
                $("#result").text(JSON.stringify(data))
                alert("编辑成功")
                location.href="${base}/admin-list"
            }
        });
    }

 
</script>
</body> 
</html>